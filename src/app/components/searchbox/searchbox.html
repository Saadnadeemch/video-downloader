<div class="w-full max-w-5xl mx-auto">
  <!-- Input Section -->
  <div class="bg-white/90 backdrop-blur-sm rounded-3xl shadow-2xl p-6 md:p-8 mb-8 border border-gray-100">
    <div class="text-center mb-5 md:mb-6">
      <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-2">Paste Your Video URL</h2>
      <p class="text-gray-600 text-sm md:text-base">
        Support for 1000+ platforms including YouTube, TikTok, Instagram, Facebook & more
      </p>
    </div>



    <div class="flex flex-col md:flex-row gap-3 md:gap-4 items-stretch md:items-center">
      <!-- Input -->
      <div class="relative flex-1 group">
        <input type="text" [(ngModel)]="url" placeholder="Paste video link here" class="h-12 md:h-16 pl-4 md:pl-6 pr-12 md:pr-16 text-base md:text-lg 
                 border border-gray-200 rounded-xl md:rounded-2xl bg-gray-50 
                 transition-all duration-300 w-full
                 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:bg-white" />

        <!-- Paste button -->
        <button type="button" *ngIf="!url; else clearButton" (click)="handlePaste()" class="absolute right-2 md:right-3 top-1/2 transform -translate-y-1/2
         h-8 w-8 md:h-10 md:w-10 p-0 rounded-lg md:rounded-xl
         hover:bg-purple-100 transition-all duration-200
         flex items-center justify-center text-xl" title="Paste from clipboard">
          <img src="paste-icon.png" class="h-8" alt="">
        </button>

        <!-- Clear button -->
        <ng-template #clearButton>
          <button type="button" (click)="url = ''" class="absolute right-2 md:right-3 top-1/2 transform -translate-y-1/2
           h-8 w-8 md:h-10 md:w-10 p-0 rounded-lg md:rounded-xl
           hover:bg-purple-100 transition-all duration-200
           flex items-center justify-center text-xl font-bold text-gray-700" title="Clear input">
            <img src="remove-icon.png" class="h-10" alt="">
          </button>
        </ng-template>

      </div>

      <!-- Quality Dropdown -->
      <div class="relative flex-shrink-0 w-full md:w-auto z-50">
        <button type="button"
          class="h-12 md:h-16 w-full px-4 md:px-6 rounded-xl md:rounded-2xl border-2 border-gray-200 focus:border-purple-500 bg-gray-50 text-base md:text-lg transition-all duration-300 flex items-center justify-between focus:ring-2 focus:ring-purple-400"
          (click)="toggleDropdown($event)" [attr.aria-expanded]="showDropdown">
          <span class="truncate">{{ selectedQuality || 'Select Quality' }}</span>
          <svg class="ml-2 w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>

        <ul *ngIf="showDropdown"
          class="absolute z-50 left-0 right-0 mt-2 bg-white shadow-2xl rounded-xl border border-gray-200 max-h-52 overflow-auto animate-fadeIn"
          (click)="$event.stopPropagation()">
          <li *ngFor="let q of qualityOptions" (click)="selectQuality(q)"
            class="px-4 py-2 cursor-pointer hover:bg-purple-50 transition-colors text-base flex items-center"
            [ngClass]="{ 'font-bold text-purple-700 bg-purple-50': q === selectedQuality }">
            {{ q }}
          </li>
        </ul>
      </div>

      <!-- Get Info Button -->
      <button (click)="handleDownloadRequest()" [disabled]="isLoading"
        class="h-12 md:h-16 w-full md:w-auto px-6 md:px-10 font-semibold bg-gradient-to-r from-purple-600 via-blue-600 to-indigo-600 hover:from-purple-700 hover:via-blue-700 hover:to-indigo-700 text-white rounded-xl md:rounded-2xl transition-all duration-300 shadow hover:shadow-lg flex items-center justify-center mt-2 md:mt-0 focus:ring-2 focus:ring-purple-400">
        <ng-container *ngIf="isLoading; else notLoading">
          <svg class="w-5 h-5 animate-spin mr-2" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10" stroke="white" stroke-width="4" fill="none" />
            <path d="M12 2a10 10 0 1 1-9.95 9H12V2z" fill="white" />
          </svg>
          Processing...
        </ng-container>
        <ng-template #notLoading>
          Get Video Info
        </ng-template>
      </button>
    </div>

    <!-- Global Error (when fetching info fails) -->
    <div *ngIf="errorMessage && !videoInfo"
      class="flex items-center justify-center gap-2 bg-red-100 text-red-600 px-4 py-2 rounded-md text-sm mt-4 text-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 shrink-0" fill="none" viewBox="0 0 24 24"
        stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M12 9v2m0 4h.01M12 2a10 10 0 100 20 10 10 0 000-20z" />
      </svg>
      {{ errorMessage }}
    </div>

  </div>

  <!-- Video Info -->
  <div *ngIf="videoInfo" class="bg-white/90 backdrop-blur-sm rounded-3xl shadow-xl p-6 md:p-8 border border-gray-100">
    <div class="flex flex-col lg:flex-row gap-6 md:gap-8">
      <!-- Thumbnail -->
      <div class="w-full lg:w-80 flex-shrink-0">
        <img [src]="videoInfo.thumbnail || 'default.jpg'" [alt]="videoInfo.title || 'Default Thumbnail'"
          class="w-full h-36 md:h-48 object-cover rounded-xl md:rounded-2xl shadow-lg" />
      </div>

      <!-- Info & Buttons -->
      <div class="flex-1">
        <h3 class="text-xl md:text-2xl font-bold text-gray-900 mb-2 md:mb-4 leading-tight">{{ videoInfo.title }}</h3>
        <div class="flex flex-wrap items-center gap-3 md:gap-6 mb-4 text-gray-600 text-sm md:text-base">
          <span class="flex items-center gap-2 font-semibold">Author : {{ videoInfo.uploader }}</span>
          <span>{{ videoInfo.views }} views</span>
          <span>{{ videoInfo.likes }} likes</span>
        </div>

        <!-- Case 1: separated-av -->
        <div *ngIf="platformType === 'separate-av'" class="space-y-3 md:space-y-4">
          <!-- Progress Bar (only for separated-av) -->
          <div *ngIf="showProgress"
            class="w-full md:max-w-xl h-[15px] rounded-full bg-gray-200 overflow-hidden shadow-inner">
            <div class="h-full bg-gradient-to-r from-purple-500 to-indigo-500 rounded-full transition-all duration-500"
              [style.width.%]="progressPercent" [style.boxShadow]="'0 0 6px #7c3aed88'"></div>
          </div>

          <!-- Download Button -->
          <button (click)="downloadReady ? handleDownloadFile() : null" class="w-full md:w-auto font-semibold rounded-full py-2 px-6 shadow-lg transition-all duration-300 
                  text-sm md:text-base flex items-center justify-center gap-2 text-white
                  bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700">
            <svg *ngIf="downloadReady" class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2"
              viewBox="0 0 24 24">
              <path d="M4 12l1.41-1.41L11 16.17V4h2v12.17l5.59-5.58L20 12l-8 8-8-8z"></path>
            </svg>
            {{ downloadReady ? 'Save To Device' : downloadText }}
          </button>
        </div>
        <!-- Case 2: stream-download -->
        <div *ngIf="platformType === 'stream-download'" class="space-y-3 md:space-y-4">
          <button (click)="handleStream()" class="w-full md:w-auto font-semibold rounded-full py-2 px-6 shadow-lg transition-all duration-300
          text-sm md:text-base flex items-center justify-center gap-2 text-white
          bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700">
            Stream Now
          </button>
        </div>

        <!-- Case 3: direct-download -->
        <div *ngIf="platformType === 'direct-download'" class="space-y-3 md:space-y-4">
          <button (click)="handleDirectDownload()" class="w-full md:w-auto font-semibold rounded-full py-2 px-6 shadow-lg transition-all duration-300
          text-sm md:text-base flex items-center justify-center gap-2 text-white
          bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700">
            Direct Download
          </button>
        </div>

        <!-- Error Message -->
        <div *ngIf="errorMessage"
          class="flex items-center justify-center gap-2 bg-red-100 text-red-600 px-4 py-2 rounded-md text-sm text-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 shrink-0" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 9v2m0 4h.01M12 2a10 10 0 100 20 10 10 0 000-20z" />
          </svg>
          {{ errorMessage }}
        </div>
      </div>
    </div>
  </div>